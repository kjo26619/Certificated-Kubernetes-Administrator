# TLS Certificates

TLS(Transport Layer Security)는 보안 통신을 위한 프로토콜이다. 

인증을 하기 위해 아이디와 패스워드를 서버에게 보낼 때 당연히 메시지가 공격자에게 들어갈 수 있다.

만약 평문으로 메시지를 보낸다면 공격자는 탈취한 메시지를 통해 아이디와 패스워드를 마음껏 사용할 수 있다.

이런 점을 방지하기 위해 송신자와 수신자는 대칭키와 공개키 암호를 사용한다.

대칭키는 송신자와 수신자 간에 같은 암호화 키를 나눠가진 뒤 암호화하여 통신하는데 사용한다.

공개키는 개인키-공개키 쌍으로 이루어진 암호화 키를 이용하는 방식이다. 개인키로 암호화된 메시지는 공개키로, 공개키로 암호화된 메시지는 개인키로 복호화할 수 있다.

공개키 방식은 수신자가 개인키-공개키를 생성하면 공개키를 저장소에 공개한다. 그리고 송신자가 공개키로 암호화해서 보내면 수신자는 개인키로 복호화할 수 있다.

두 방식 모두 단점이 있는데 대칭키의 경우 암호화 키를 공격자에게 탈취당하면 모든 보안이 무의미해진다는 단점이 있다. 

그리고 공개키는 대칭키에 비해 속도가 느리다는 점이다.

이러한 단점을 없애기 위해 TLS 인증서를 이용해서 공개키 방식으로 대칭키를 교환한다.

1. 서버와 클라이언트가 서로 통신을 하기 전에 클라이언트는 서버에게 인증 요청을 보낸다. (TLS 버전, 설정 등이 포함)
2. 인증 요청을 받은 서버는 통신이 가능할 경우 응답을 보낸다. (TLS 버전, 설정 등이 포함)
3. 서버가 인증서를 보낸다. 서버는 자신의 공개키를 포함하여 보낸다.
4. 클라이언트는 서버에게서 받은 인증서를 검증한다. 이러한 검증을 위해 CA(Certificate Authority)에서 서버의 인증서를 검증하고 저장해놓는다.
5. 클라이언트는 받은 공개키를 이용해서 암호화된 메시지를 보낸다. 여기에 대칭키를 만들기 위한 정보가 들어있다.
6. 서버는 개인키로 메시지를 복호화한 뒤 대칭키를 만들어낸다. 클라이언트 역시 대칭키를 만든다.
7. 대칭키를 이용하여 통신한다.

TLS 인증서는 이렇게 통신의 보안을 유지하며 클라이언트가 공격자의 피싱 등에 방지할 수 있도록 돕는다.

공격자는 자신의 인증서를 만들어내도 CA에 의해 검증받지 못하게 된다. 즉, 클라이언트 측에서는 TLS 인증서 검증으로 공격자의 피싱 등을 확인할 수 있다.

# TLS Certificates in Kubernetes

Kubernetes에서는 모든 구성 요소 간에 통신에서 보안 유지를 위해서 TLS 인증서를 사용한다.

따로, 유저 정보를 저장하는 것이 아닌 인증서로 Kubernetes에 권한이 있는지 확인을 한다. 

